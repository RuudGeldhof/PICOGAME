pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

function new_player(x,y,i)
	local player = {}
	player.x = x
	player.y = y
	player.controlindex = i
	player.sprite = 1
	player.walkanimation = 0
	player.direction = 3 --face south
	return player
end

function new_bomb(x,y)
	local bomb = {}
	bomb.x = x
	bomb.y = y
	bomb.time = 90 --3sec fuse
end
	

function _init()
	players = {
	new_player(90,90,0),
	new_player(32,32,1)
	}
end

function _draw()
	cls()
	map(0,0,0,0,16,16) --background
	map(16,0,0,0,16,16) --colliding layers
	foreach (players,draw_player)	
end

function _update()
	foreach(players,update_player)
end

function draw_bomb(bomb)

end

function draw_player(player)
	--pset(player.x,player.y,10)
	if(player.walkanimation >= 4) player.walkanimation = 0
	local frame = 0
 local wa = flr(player.walkanimation)	
	if(wa == 1) frame = 1
	if(wa == 3) frame = 2
	local flipx = false
	if player.direction == 0 
	then
		player.sprite = 7 + frame
	elseif player.direction == 1 
	then
		flipx = true
		player.sprite = 7 + frame
	elseif player.direction == 2
	then
		player.sprite = 4 + frame 
	elseif player.direction == 3
	then
		player.sprite = 1 + frame
	end
	spr(player.sprite,player.x,player.y,1,1,flipx,false)
end

function update_player(player)
 --move left
	if btn(0,player.controlindex)
	then
		if not checkflag(player.x,player.y+1,16,0,0)
		and not checkflag(player.x,player.y+7,16,0,0)
		then 
			player.x -= 1
		end
		player.direction = 0
	end
	--move right
	if btn(1,player.controlindex) 
	then
		if not checkflag(player.x+8,player.y+1,16,0,0)
		and not checkflag(player.x+8,player.y+7,16,0,0)
		then
			player.x += 1
		end
		player.direction = 1
	end
	--move up
	if btn(2,player.controlindex) 
	then
		if not checkflag(player.x+1,player.y,16,0,0)
		and not checkflag(player.x+7,player.y,16,0,0)
		then 
			player.y -= 1
		end
		player.direction = 2
	end
	--move down
	if btn(3,player.controlindex)
	then
		if not checkflag(player.x+1,player.y+8,16,0,0)
		and not checkflag(player.x+7,player.y+8,16,0,0)
		then 
			player.y += 1
		end
		player.direction = 3
	end
	if btn(0,player.controlindex)
	or btn(1,player.controlindex)
	or btn(2,player.controlindex)
	or btn(3,player.controlindex)
	then 		
		player.walkanimation += 0.334
	else
		player.walkanimation = 0
	end
end

function checkflag(x,y,mapx,mapy,flag)
	cell = mget (mapx+flr(x / 8),mapy+flr(y / 8))
	if fget(cell,flag) then
		return true
	else
		return false
	end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009999000099990000999900009999000099990000999900009999000099990000999900000000000000000000000000000000000000000000000000
0070070000ffff0000ffff0000ffff0000999900009999000099990000ff990000ff990000ff9900000000000000000000000000000000000000000000000000
00077000005ff500005ff500005ff50000f99f0000f99f0000f99f00005fff00005fff00005fff00000000000000000000000000000000000000000000000000
0007700000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff00000000000000000000000000000000000000000000000000
007007000f8888f00f888800008888f00f8888f0008888f00f888800008888000088880000888800000000000000000000000000000000000000000000000000
0000000000888800008888f00f888800008888000f888800008888f0008f88000088f80000f88800000000000000000000000000000000000000000000000000
00000000008008000080020000200800008008000020080000800200000880000088220000228800000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00333300003333000033330000333300003333000033330000333300003333000033330000000000000000000000000000000000000000000000000000000000
00333300003333000033330000333300003333000033330000333300003333000033330000000000000000000000000000000000000000000000000000000000
00833800008338000083380000333300003333000033330000833300008333000083330000000000000000000000000000000000000000000000000000000000
00333300003333000033330000333300003333000033330000333300003333000033330000000000000000000000000000000000000000000000000000000000
03555530035555000055553003555530005555300355550000555500005555000055550000000000000000000000000000000000000000000000000000000000
00555500005555300355550000555500035555000055553000535500005535000035550000000000000000000000000000000000000000000000000000000000
00500500005001000010050000500500001005000050010000055000005511000011550000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
51551515515555515155551511555151155555550011111000111100000000000000000000000000000000000000000000000000000000000000000000000000
555555555555555555555555555555555565555101dd6d1101dd6d10000000000000000000000000000000000000000000000000000000000000000000000000
1555d51555155d1515d5551515555d55555555551dddd6d11dddd6d1000000000000000000000000000000000000000000000000000000000000000000000000
55515551555555555515555555555555555515551dddddd11dddddd1000000000000000000000000000000000000000000000000000000000000000000000000
5555155555551551555515515d515551551555551dddddd11dddddd1000000000000000000000000000000000000000000000000000000000000000000000000
551555555555555515555555155555555555555511ddd1d111ddd111000000000000000000000000000000000000000000000000000000000000000000000000
5d555555555555555555555555555515155555550111111101111110000000000000000000000000000000000000000000000000000000000000000000000000
15555155551515511515515155115551555556510011110000111000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000005000088850000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
144444410001510008885a8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1444444100111610888888a800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
41111114011111618888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
144aa441011111118888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
144a9441011111118888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
14444441001111100888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000111000088880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4240434343404040404040434143424245454545454645464545454546454546460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242404042424242424243434144434345474747474747454647474747474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343434242404240434040434040414345474747474747464547474747474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343434242424242404243434143414246474745464747464647474645474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4043424343434340424242414343414245474747464747454647474647474746000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343424343444343424243434343404345474747474747464647474747474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4342424242424343434343404343434045474747454645464646454547474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4043404042424343404043414141414045474747474647474747464747474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4240434343404040404040434143424245474747474747474747474747474746000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4242404042424242424243434144434346474747474747464647474747474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343434242404240434040434040414345474747454545454545454547474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343434240424242404243434143414245474747474747454547474747474746000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4043424343434340424242414343414245474647474747454547474747454745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4343424343444343424243434343404345474745454747454547474645474746000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4342424242424343434343404343434046474747474747454547474747474745000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4043404042424343404043414141414046454546454546454545454546454545000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
